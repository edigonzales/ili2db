<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Anleitung zur Programmfamilie ili2db</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ili2db_files/libs/clipboard/clipboard.min.js"></script>
<script src="ili2db_files/libs/quarto-html/quarto.js"></script>
<script src="ili2db_files/libs/quarto-html/popper.min.js"></script>
<script src="ili2db_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ili2db_files/libs/quarto-html/anchor.min.js"></script>
<link href="ili2db_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ili2db_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ili2db_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ili2db_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ili2db_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul class="collapse">
  <li><a href="#überblick" id="toc-überblick" class="nav-link active" data-scroll-target="#überblick"><span class="header-section-number">1</span> Überblick</a>
  <ul class="collapse">
  <li><a href="#schemaimport-in-die-datenbank" id="toc-schemaimport-in-die-datenbank" class="nav-link" data-scroll-target="#schemaimport-in-die-datenbank"><span class="header-section-number">1.1</span> Schemaimport in die Datenbank</a></li>
  <li><a href="#import-in-die-datenbank" id="toc-import-in-die-datenbank" class="nav-link" data-scroll-target="#import-in-die-datenbank"><span class="header-section-number">1.2</span> Import in die Datenbank</a></li>
  <li><a href="#export-aus-der-datenbank" id="toc-export-aus-der-datenbank" class="nav-link" data-scroll-target="#export-aus-der-datenbank"><span class="header-section-number">1.3</span> Export aus der Datenbank</a></li>
  <li><a href="#log-meldungen" id="toc-log-meldungen" class="nav-link" data-scroll-target="#log-meldungen"><span class="header-section-number">1.4</span> Log-Meldungen</a></li>
  <li><a href="#fehlerhafte-daten" id="toc-fehlerhafte-daten" class="nav-link" data-scroll-target="#fehlerhafte-daten"><span class="header-section-number">1.5</span> Fehlerhafte Daten</a></li>
  <li><a href="#laufzeitanforderungen" id="toc-laufzeitanforderungen" class="nav-link" data-scroll-target="#laufzeitanforderungen"><span class="header-section-number">1.6</span> Laufzeitanforderungen</a></li>
  <li><a href="#lizenz" id="toc-lizenz" class="nav-link" data-scroll-target="#lizenz"><span class="header-section-number">1.7</span> Lizenz</a></li>
  </ul></li>
  <li><a href="#sec-funktionsweise" id="toc-sec-funktionsweise" class="nav-link" data-scroll-target="#sec-funktionsweise"><span class="header-section-number">2</span> Funktionsweise</a>
  <ul class="collapse">
  <li><a href="#schemaimport-funktionen" id="toc-schemaimport-funktionen" class="nav-link" data-scroll-target="#schemaimport-funktionen"><span class="header-section-number">2.1</span> Schemaimport-Funktionen</a></li>
  <li><a href="#export-funktionen" id="toc-export-funktionen" class="nav-link" data-scroll-target="#export-funktionen"><span class="header-section-number">2.2</span> Export-Funktionen</a></li>
  <li><a href="#prüf-funktionen" id="toc-prüf-funktionen" class="nav-link" data-scroll-target="#prüf-funktionen"><span class="header-section-number">2.3</span> Prüf-Funktionen</a></li>
  <li><a href="#migration-von-3.x-nach-4.x" id="toc-migration-von-3.x-nach-4.x" class="nav-link" data-scroll-target="#migration-von-3.x-nach-4.x"><span class="header-section-number">2.4</span> Migration von 3.x nach 4.x</a></li>
  </ul></li>
  <li><a href="#sec-referenz" id="toc-sec-referenz" class="nav-link" data-scroll-target="#sec-referenz"><span class="header-section-number">3</span> Referenz</a>
  <ul class="collapse">
  <li><a href="#aufruf-syntax" id="toc-aufruf-syntax" class="nav-link" data-scroll-target="#aufruf-syntax"><span class="header-section-number">3.1</span> Aufruf-Syntax</a></li>
  <li><a href="#optionen" id="toc-optionen" class="nav-link" data-scroll-target="#optionen"><span class="header-section-number">3.2</span> Optionen</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Anleitung zur Programmfamilie ili2db</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="überblick" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Überblick</h1>
<p><em>ilid2db</em> ist eine in Java erstellte Programmfamilie, die zurzeit <em>ili2pg</em>, <em>ili2fgdb</em>, <em>ili2gpkg</em>, <em>ili2ora</em>, <em>ili2mssql</em>, <em>ili2mysql</em> und <em>ili2h2gis</em> umfasst.</p>
<p>Damit kann eine INTERLIS-Transferdatei (itf oder xtf) einem INTERLIS-Modell entsprechend (ili) mittels 1:1-Transfer in eine Datenbank (PostgreSQL/Postgis bzw. GeoPackage) gelesen werden oder aus der Datenbank mittels einem 1:1-Transfer eine solche Transferdatei erstellt werden. Folgende Funktionen sind möglich:</p>
<ul>
<li>erstellt das Datenbankschema aus einem INTERLIS-Modell</li>
<li>importiert Daten aus einer Transferdatei in die Datenbank</li>
<li>exportiert Daten aus der Datenbank in eine Transferdatei</li>
</ul>
<p>Folgende Transferformate werden unterstützt:</p>
<ul>
<li>INTERLIS 1</li>
<li>INTERLIS 2</li>
<li>GML 3.2<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
</ul>
<section id="schemaimport-in-die-datenbank" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="schemaimport-in-die-datenbank"><span class="header-section-number">1.1</span> Schemaimport in die Datenbank</h2>
<p>Beim Schemaimport (<code>--schemaimport</code>) wird anhand des INTERLIS-Modells das Datenbankschema angelegt.</p>
<p>Diverse Optionen beeinflussen die Abbildung.</p>
<p>Den Geometrien kann mittels Parameter ein EPSG-Code zugewiesen werden. Die Geometrie-Attribute können optional indexiert werden.</p>
<p>Beispiel:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2gpkg.jar <span class="at">--schemaimport</span> <span class="at">--dbfile</span> mogis.gpkg path/to/dm01av.ili</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="import-in-die-datenbank" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="import-in-die-datenbank"><span class="header-section-number">1.2</span> Import in die Datenbank</h2>
<p>Der Import (<code>--import</code>) schreibt alle Objekte (im Sinne der eigentlichen Daten) der Transferdatei in die Datenbank.</p>
<p>Diverse Optionen beeinflussen, was mit den bestehenden Daten in der DB geschieht.</p>
<p>AREA- und SURFACE-Geometrien werden bei INTERLIS 1 polygoniert.</p>
<p>Kreisbögen werden als Kreisbögen importiert und somit nicht segmentiert (oder können optional auch segmentiert werden).</p>
<p>Beispiel:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2gpkg.jar <span class="at">--import</span> <span class="at">--dbfile</span> mogis.gpkg path/to/data.xtf</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="export-aus-der-datenbank" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="export-aus-der-datenbank"><span class="header-section-number">1.3</span> Export aus der Datenbank</h2>
<p>Der Export (<code>--export</code>) schreibt alle Daten aus der Datenbank in eine Transferdatei.</p>
<p>Mit weiteren Optionen wird gesteuert, welche Daten aus der Datenbank exportiert werden.</p>
<p>Genau einer der Parameter <code>--models</code>, <code>--topics</code>, <code>--baskets</code> oder <code>--dataset</code> muss zwingend verwendet werden, um die zu exportierenden DB-Records auszuwählen.</p>
<p>Der Parameter <code>--exportModels</code> definiert das Export-Modell, indem die Daten exportiert werden (der Parameter ist also keine Alternative, sondern ein Zusatz für <code>--models</code>, <code>--topics</code>, <code>--baskets</code> oder <code>--dataset</code>). Als Export-Modelle sind Basis-Modelle (also z.B. Bundes-Modell statt Kantons-Modell) oder übersetzte Modelle (also z.B. DM_IT statt DM_DE) zulässig. Ohne die Option <code>--exportModels</code> werden die Daten so wie sie erfasst sind (bzw. importiert wurden), exportiert.</p>
<p>Geometrien vom Typ <em>AREA</em> und <em>SURFACE</em> werden bei INTERLIS 1 während dem Export in Linien umgewandelt.</p>
<p>Beispiel:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2gpkg.jar <span class="at">--export</span> <span class="at">--models</span> DM01 <span class="at">--dbfile</span> mogis.gpkg path/to/output.xtf</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="log-meldungen" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="log-meldungen"><span class="header-section-number">1.4</span> Log-Meldungen</h2>
<p>Die Log-Meldungen sollen dem Benutzer zeigen, was das Programm macht. Am Anfang erscheinen Angaben zur Programm-Version. Falls das Programm ohne Fehler durchläuft, wird das am Ende ausgegeben.:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Info:</span> ili2fgdb-3.10.7-20170823</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Info:</span> compile models...</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Info:</span> ...export done</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Bei einem Fehler wird das am Ende des Programms vermerkt. Der eigentliche Fehler wird aber in der Regel schon früher ausgegeben.:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Info:</span> ili2fgdb-3.10.7-20170823</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Info:</span> compile models...</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Error:</span> DM01.Bodenbedeckung.BoFlaeche_Geometrie: intersection tids 48, 48</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Error:</span> ...import failed</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="fehlerhafte-daten" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="fehlerhafte-daten"><span class="header-section-number">1.5</span> Fehlerhafte Daten</h2>
<p>Um fehlerhaften Daten zu importieren (um sie danach (z.B. im GIS) zu flicken), muss mindestens die Validierung ausgeschaltet werden (<code>--disableValidation</code>). Das DB-Schema muss aber auch so angelegt werden, dass fehlerhafte Werte als Text importiert werden können (<code>--sqlColsAsText</code>) bzw. durch <code>NULL</code> ersetzt werden können (<code>--sqlEnableNull</code>). Und die Programmlogik für den Datenimport muss die Fehler tolerieren (<code>--skipReferenceErrors</code> und <code>--skipGeometryErrors</code>), so dass z.B. eine Referenz auf ein nicht vorhandenes Objekt ignoriert wird.</p>
<p>Um solche Daten zu importieren (um sie danach zu flicken):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2gpkg.jar <span class="at">--schemaimport</span> <span class="at">--sqlEnableNull</span> <span class="at">--sqlColsAsText</span> <span class="dt">\</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>--dbfile mogis.gpkg path/to/mo.ili</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2gpkg.jar <span class="at">--import</span> <span class="at">--skipReferenceErrors</span> <span class="at">--skipGeometryErrors</span> <span class="dt">\</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>--disableValidation <span class="at">--dbfile</span> mogis.gpkg path/to/data.xtf</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Bei ITF (INTERLIS 1): Fehlerhafte <em>AREA</em> Attribute können für den ganzen Datensatz nicht als Polygone gelesen werden, weil ein Programm nicht erkennen kann, welche Linien und Punkte falsch sind (Punkt und/oder Linie zu viel oder zu wenig; Linie zu kurz oder zu lang); und somit nicht erkennen kann, bei welchem Polygon der Fehler ist. Dass diese Daten nicht gelesen werden können, hat also nicht in erster Linie mit der Validierung zu tun, sondern damit, dass aus den Linien+Punkten keine Polygone gebildet werden können. Die Polygonbildung muss also ausgeschaltet werden (<code>--skipPolygonBuilding</code>).</p>
<p>Um solche Daten zu importieren (um sie danach zu flicken):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2gpkg.jar <span class="at">--schemaimport</span> <span class="at">--sqlEnableNull</span> <span class="at">--sqlColsAsText</span> <span class="dt">\</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>--skipPolygonBuilding <span class="at">--dbfile</span> mogis.gpkg path/to/mo.ili</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2gpkg.jar <span class="at">--import</span> <span class="at">--skipReferenceErrors</span> <span class="at">--skipPolygonBuilding</span> <span class="dt">\</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>--skipGeometryErrors <span class="at">--disableValidation</span> <span class="at">--dbfile</span> mogis.gpkg path/to/data.itf</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Bei XTF (INTERLIS 2): Fehlerhafte <em>SURFACE/AREA</em> Attribute können als Linien (statt als Polygone) eingelesen werden. Die Polygonbildung muss also ausgeschaltet werden (<code>--skipPolygonBuilding</code>).</p>
<p>Um solche Daten zu importieren (um sie danach zu flicken):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2gpkg.jar <span class="at">--schemaimport</span> <span class="at">--sqlEnableNull</span> <span class="at">--sqlColsAsText</span> <span class="dt">\</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>--skipPolygonBuilding <span class="at">--dbfile</span> mogis.gpkg path/to/mo.ili</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2gpkg.jar <span class="at">--import</span> <span class="at">--skipReferenceErrors</span> <span class="at">--skipPolygonBuilding</span> <span class="dt">\</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>--skipGeometryErrors <span class="at">--disableValidation</span> <span class="at">--dbfile</span> mogis.gpkg path/to/data.xtf</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="laufzeitanforderungen" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="laufzeitanforderungen"><span class="header-section-number">1.6</span> Laufzeitanforderungen</h2>
<p>Das Programm setzt Java 1.8 voraus.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">PostGIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">FileGDB</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">GeoPackage</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Als Datenbank muss mindestens PostgreSQL 8.3 und PostGIS 1.5 vorhanden sein. Falls das INTERLIS-Datenmodell INTERLIS.UUIDOID als OID verwendet, wird die Funktion <em>uuid_generate_v4()</em> verwendet. Dazu muss die PostgreSQL-Erweiterung <em>uuid-ossp</em> konfiguriert sein (<code>CREATE EXTENSION "uuid-ossp";</code>). Mit der Option <code>--setupPgExt</code> erstellt <em>ili2pg</em> die fehlenden notwendigen Erweiterungen.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Es muss <a href="https://www.microsoft.com/en-us/download/details.aspx?id=48145">Visual Studio 2015 C and C++ Runtimes</a> installiert sein. Je nach Java Version (Die Java Version ist massgebend, nicht die Windows Version) muss die 32-bit oder 64-bit Version dieser Laufzeitbibliothek installiert sein. Falls diese Laufzeitbibliothek nicht installiert ist, gibt es einen Fehler beim laden der FileGDB.dll. Zur Laufzeit entpackt <em>ili2fgdb</em> zwei DLLs/Shared-Libraries und lädt diese. Der Benutzer benötigt also die Berechtigungen, um diese Bibliotheken zu laden.</p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Zur Laufzeit entpackt ili2gpkg eine DLL/Shared-Library und lädt diese. Der Benutzer benötigt also die Berechtigungen, um die Bibliothek zu laden.</p>
</div>
</div>
</div>
</section>
<section id="lizenz" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="lizenz"><span class="header-section-number">1.7</span> Lizenz</h2>
<p>GNU Lesser General Public License</p>
</section>
</section>
<section id="sec-funktionsweise" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Funktionsweise</h1>
<p>In den folgenden Abschnitten wird die Funktionsweise anhand einzelner Anwendungsfälle beispielhaft beschrieben. Die detaillierte Beschreibung einzelner Funktionen ist in <a href="#sec-referenz" class="quarto-xref">Kapitel&nbsp;3</a> zu finden.</p>
<section id="schemaimport-funktionen" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="schemaimport-funktionen"><span class="header-section-number">2.1</span> Schemaimport-Funktionen</h2>
<section id="fall-1.1" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="fall-1.1"><span class="header-section-number">2.1.1</span> Fall 1.1</h3>
<p>Die Tabellen existieren nicht und sollen in der Datenbank angelegt werden (<code>--schemaimport</code>).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">PostGIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">GeoPackage</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">FileGDB</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2pg.jar <span class="at">--schemaimport</span> <span class="at">--dbdatabase</span> mogis <span class="at">--dbusr</span> julia <span class="dt">\</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>--dbpwd romeo path/to/dm01.ili</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Die leeren Tabellen werden im Default-Schema des Benutzers <code>julia</code> angelegt. Die Geometrie-Spalten werden in der Tabelle <code>public.geometry_columns</code> registriert.</p>
<p>Als Host wird der lokale Rechner angenommen und für die Verbindung zur Datenbank der Standard-Port.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2gpkg.jar <span class="at">--schemaimport</span> <span class="at">--dbfile</span> mogis.gpkg path/to/dm01.ili</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Die Geometrie-Spalten werden in den Tabellen <code>gpkg_contents</code> und <code>gpkg_geometry_columns</code> registriert.</p>
<p>Falls die Datei mogis.gpkg noch nicht existiert, wird sie erzeugt und mit den für GeoPackage nötigen Metatabellen initialisiert. Falls die Datei schon existiert, werden die Tabellen ergänzt.</p>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2fgdb.jar <span class="at">--schemaimport</span> <span class="at">--dbfile</span> mogis.gdb path/to/dm01.ili</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Falls die Datei mogis.gdb noch nicht existiert, wird sie erzeugt. Falls die Datei schon existiert, werden die Tabellen ergänzt.</p>
</div>
</div>
</div>
<p>Es werden keine Daten importiert, sondern nur die leeren Tabellen angelegt.</p>
</section>
</section>
<section id="export-funktionen" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="export-funktionen"><span class="header-section-number">2.2</span> Export-Funktionen</h2>
<p>lorem ipsum</p>
</section>
<section id="prüf-funktionen" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="prüf-funktionen"><span class="header-section-number">2.3</span> Prüf-Funktionen</h2>
<p>lorem ipsum</p>
</section>
<section id="migration-von-3.x-nach-4.x" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="migration-von-3.x-nach-4.x"><span class="header-section-number">2.4</span> Migration von 3.x nach 4.x</h2>
<p>lorem ipsum</p>
</section>
</section>
<section id="sec-referenz" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Referenz</h1>
<p>In den folgenden Abschnitten werden einzelne Aspekte detailliert, aber isoliert, beschrieben. Die Funktionsweise als Ganzes wird anhand einzelner Anwendungsfälle beispielhaft in <a href="#sec-funktionsweise" class="quarto-xref">Kapitel&nbsp;2</a> (weiter oben) beschrieben.</p>
<p>Die Dokumentation gilt grundsätzlich für alle ili2db-Varianten, ausser es gibt einen spezifischen Hinweis auf PostGIS, GeoPackage oder FileGDB.</p>
<section id="aufruf-syntax" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="aufruf-syntax"><span class="header-section-number">3.1</span> Aufruf-Syntax</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">PostGIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">GeoPackage</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">FileGDB</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2pg.jar <span class="pp">[</span><span class="ss">Options</span><span class="pp">]</span> <span class="pp">[</span><span class="ss">file</span><span class="pp">]</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2fgdb.jar <span class="pp">[</span><span class="ss">Options</span><span class="pp">]</span> <span class="pp">[</span><span class="ss">file</span><span class="pp">]</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> ili2fgdb.jar <span class="pp">[</span><span class="ss">Options</span><span class="pp">]</span> <span class="pp">[</span><span class="ss">file</span><span class="pp">]</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Der Rückgabewert ist wie folgt:</p>
<ul>
<li>0 Import/Export ok, keine Fehler festgestellt</li>
<li>!0 Import/Export nicht ok, Fehler festgestellt</li>
</ul>
<p>Optionen:</p>
<table class="table">
<caption>Optionen</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Option</th>
<th>Beschreibung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>--import</code></td>
<td><p>Importiert Daten aus einer Transferdatei in die Datenbank.</p>
<p>Die Tabellen werden implizit auch angelegt, falls sie noch nicht vorhanden sind (siehe Kapitel Abbildungsregeln). Falls die Tabellen in der Datenbank schon vorhanden sind, können sie zusätzliche Spalten enthalten (z.B. bfsnr, datum etc.), welche beim Import leer bleiben.</p>
<p>Falls beim Import ein Datensatz-Identifikator (–dataset) definiert wird, darf dieser Datensatz-Identifikator in der Datenbank noch nicht vorhanden sein. Um die bestehenden Daten zu ersetzen, kann die Option –replace verwendet werden.</p>
<p>TODO: Die Tabellen sind schon vorhanden (und entsprechen (nicht) der ili-Klasse).</p></td>
</tr>
<tr class="even">
<td><code>--import</code></td>
<td><p>Importiert Daten aus einer Transferdatei in die Datenbank.</p>
<p>Die Tabellen werden implizit auch angelegt, falls sie noch nicht vorhanden sind (siehe Kapitel Abbildungsregeln). Falls die Tabellen in der Datenbank schon vorhanden sind, können sie zusätzliche Spalten enthalten (z.B. bfsnr, datum etc.), welche beim Import leer bleiben.</p>
<p>Falls beim Import ein Datensatz-Identifikator (–dataset) definiert wird, darf dieser Datensatz-Identifikator in der Datenbank noch nicht vorhanden sein. Um die bestehenden Daten zu ersetzen, kann die Option –replace verwendet werden.</p>
<p>TODO: Die Tabellen sind schon vorhanden (und entsprechen (nicht) der ili-Klasse).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="optionen" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="optionen"><span class="header-section-number">3.2</span> Optionen</h2>
<section id="import" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="import"><span class="header-section-number">3.2.1</span> <code>--import</code></h3>
<p>Importiert Daten aus einer Transferdatei in die Datenbank.</p>
<p>Die Tabellen werden implizit auch angelegt, falls sie noch nicht vorhanden sind (siehe Kapitel Abbildungsregeln). Falls die Tabellen in der Datenbank schon vorhanden sind, können sie zusätzliche Spalten enthalten (z.B. bfsnr, datum etc.), welche beim Import leer bleiben.</p>
<p>Falls beim Import ein Datensatz-Identifikator (–dataset) definiert wird, darf dieser Datensatz-Identifikator in der Datenbank noch nicht vorhanden sein. Um die bestehenden Daten zu ersetzen, kann die Option –replace verwendet werden.</p>
<p>TODO: Die Tabellen sind schon vorhanden (und entsprechen (nicht) der ili-Klasse).</p>
</section>
<section id="update" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="update"><span class="header-section-number">3.2.2</span> <code>--update</code></h3>
<p>Aktualisiert die Daten in der Datenbank anhand einer Transferdatei, d.h. neue Objekte werden eingefügt, bestehende Objekte werden aktualisiert und in der Transferdatei nicht mehr vorhandene Objekte werden gelöscht. Diese Funktion bedingt, dass das Datenbankschema mit der Option <code>--createBasketCol</code> erstellt wurde, und dass die Klassen und Topics eine stabile OID haben.</p>
<p>lorem ipsum</p>
</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Fußnoten</h2>

<ol>
<li id="fn1"><p>GML 3.2; die verwendeten Kodierungsregeln entsprechen <a href="https://ech.ch/de/ech/ech-0118/1.0">eCH-0118-1.0</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>